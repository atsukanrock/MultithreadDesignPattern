@*@model ImageProcessor.Web.Models.Home.IndexViewModel*@
@{
    ViewBag.Title = "検索キーワード指定";
}

<h2>@ViewBag.Title</h2>
<div class="row">
    <div class="col-xs-12">
        <h4>加工する画像を検索するキーワードを指定します。</h4>
        <hr />

        <div class="form-group">
            <input type="text" id="keyword" maxlength="255" class="form-control input-lg" />
            @*@Html.TextBoxFor(model => model.Keyword, new {maxlength = 255, @class = "form-control input-lg"})*@
        </div>
        <div class="row">
            <div class="col-xs-4 col-xs-offset-4">
                <input type="button" id="postkeyword" value="指定" class="btn btn-primary btn-lg btn-block" disabled="disabled" />
            </div>
        </div>
    </div>
</div>

@section scripts
{
    <!--Reference the SignalR library. -->
    <script src="/Scripts/jquery.signalR-2.1.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        $(function() {
            var keywordHub = $.connection.keywordHub;
            var $postkeyword = $('#postkeyword');

            $.connection.hub.start().done(function() {
                $postkeyword.click(function() {
                    var $keyword = $('#keyword');
                    var keyword = $keyword.val();
                    if (!keyword) {
                        return;
                    }

                    $postkeyword.prop('disabled', true);
                    keywordHub.server.post(keyword).done(function() {
                        $keyword.val('').focus();
                    }).fail(function() {
                        alert('キーワードを送れませんでした。');
                    }).always(function() {
                        $postkeyword.prop('disabled', false);
                    });
                });
                $postkeyword.prop('disabled', false);
            }).fail(function() {
                alert('サーバーに接続できませんでした。');
            });
        });
    </script>
}