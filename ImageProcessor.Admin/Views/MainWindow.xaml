<controls:MetroWindow x:Class="ImageProcessor.Admin.Views.MainWindow"
                      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                      xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
                      xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
                      xmlns:viewModels="clr-namespace:ImageProcessor.Admin.ViewModels"
                      xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                      Title="Image Processor Admin"
                      Width="1920"
                      Height="1080"
                      WindowStartupLocation="CenterScreen"
                      Background="{DynamicResource FluentBackgroundBrush}"
                      BorderThickness="0"
                      GlowBrush="{DynamicResource FluentAccentBrush}">
    <controls:MetroWindow.DataContext>
        <viewModels:MainViewModel />
    </controls:MetroWindow.DataContext>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Closed">
            <i:InvokeCommandAction Command="{Binding ClearTemporaryFilesCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="2*"/>
        </Grid.RowDefinitions>

        <!-- ヘッダー -->
        <Border Grid.Row="0" Style="{StaticResource FluentCard}" Padding="20,16">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <iconPacks:PackIconMaterial Kind="ImageMultiple"
                                              Width="32" Height="32"
                                              Foreground="{StaticResource FluentAccentBrush}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,12,0"/>
                    <TextBlock Text="Image Processor Admin"
                             Style="{StaticResource FluentSectionHeader}"
                             FontSize="24"
                             VerticalAlignment="Center"
                             Margin="0"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Command="{Binding ToggleThemeCommand}"
                          Style="{StaticResource FluentThemeToggleButton}"
                          ToolTip="テーマ切り替え"
                          Margin="0,0,16,0">
                        <iconPacks:PackIconMaterial Kind="Brightness6"
                                                  Width="20" Height="20"/>
                    </Button>
                    <Ellipse Fill="{Binding ConnectionStateFill}"
                           Width="12" Height="12"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                    <TextBlock Text="接続状態"
                             Style="{StaticResource FluentMetricLabel}"
                             VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- キーワードセクション -->
        <Border Grid.Row="1" Style="{StaticResource FluentCard}" Margin="8,8,8,4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- セクションヘッダー -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                    <iconPacks:PackIconMaterial Kind="TagMultiple"
                                              Width="24" Height="24"
                                              Foreground="{StaticResource FluentAccentBrush}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,12,0"/>
                    <TextBlock Text="検索キーワード"
                             Style="{StaticResource FluentSectionHeader}"
                             Margin="0"/>
                </StackPanel>

                <!-- コントロールパネル -->
                <Grid Grid.Row="1" Margin="0,0,0,16">
                    <StackPanel Orientation="Horizontal">
                        <Button Content="受信開始"
                              Command="{Binding StartReceivingKeywordsCommand}"
                              Style="{StaticResource FluentButton}"
                              Margin="0,0,12,0">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="Play"
                                                                  Width="16" Height="16"
                                                                  Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>
                        <Button Content="停止"
                              Command="{Binding StopReceivingKeywordsCommand}"
                              Style="{StaticResource FluentButtonSecondary}"
                              Margin="0,0,32,0">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="Stop"
                                                                  Width="16" Height="16"
                                                                  Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>

                        <Border Background="{DynamicResource FluentMetricBackgroundBrush}"
                              CornerRadius="4"
                              Padding="12,6"
                              VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="受信済み:"
                                         Style="{StaticResource FluentMetricLabel}"
                                         VerticalAlignment="Center"
                                         Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding PostedKeywords.Count}"
                                         Style="{StaticResource FluentMetricValue}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- キーワードリスト -->
                <ScrollViewer Grid.Row="2"
                            HorizontalScrollBarVisibility="Disabled"
                            VerticalScrollBarVisibility="Auto"
                            Background="Transparent">
                    <ItemsControl ItemsSource="{Binding PostedKeywords}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource FluentKeywordChip}">
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="Tag"
                                                                  Width="14" Height="14"
                                                                  Foreground="{StaticResource FluentAccentBrush}"
                                                                  VerticalAlignment="Center"
                                                                  Margin="0,0,6,0"/>
                                        <TextBlock Text="{Binding Value}"
                                                 FontSize="{Binding FontSize}"
                                                 Foreground="{StaticResource FluentTextBrush}"
                                                 VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- アクション -->
                <StackPanel Grid.Row="3"
                          Orientation="Horizontal"
                          HorizontalAlignment="Right"
                          Margin="0,12,0,0">
                    <Button Content="クリア"
                          Command="{Binding ClearKeywordsCommand}"
                          Style="{StaticResource FluentButtonSecondary}">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <iconPacks:PackIconMaterial Kind="DeleteOutline"
                                                              Width="16" Height="16"
                                                              Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 画像収集セクション -->
        <Border Grid.Row="2"
                Style="{StaticResource FluentCard}"
                Margin="8,4,8,4"
                IsEnabled="{Binding Connection, Converter={StaticResource NullToBooleanConverter}, ConverterParameter=true}">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                    <iconPacks:PackIconMaterial Kind="ImageSearch"
                                              Width="24" Height="24"
                                              Foreground="{StaticResource FluentAccentBrush}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,12,0"/>
                    <TextBlock Text="画像収集"
                             Style="{StaticResource FluentSectionHeader}"
                             Margin="0"/>
                </StackPanel>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" Grid.Column="0">
                        <Button Content="収集開始"
                              Command="{Binding SearchImagesCommand}"
                              Style="{StaticResource FluentButton}"
                              Margin="0,0,32,0">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="CloudDownload"
                                                                  Width="16" Height="16"
                                                                  Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>

                        <StackPanel Orientation="Horizontal" Margin="0,0,32,0">
                            <TextBlock Text="画像数:"
                                     Style="{StaticResource FluentMetricLabel}"
                                     VerticalAlignment="Center"
                                     Margin="0,0,8,0"/>
                            <controls:NumericUpDown Value="{Binding ImagesPerKeyword}"
                                                  Minimum="1" Maximum="255"
                                                  Width="100"
                                                  VerticalAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,32,0">
                            <TextBlock Text="検索:"
                                     Style="{StaticResource FluentMetricLabel}"
                                     VerticalAlignment="Center"
                                     Margin="0,0,8,0"/>
                            <controls:NumericUpDown Value="{Binding ImageSearcherThreadCount}"
                                                  Minimum="1" Maximum="255"
                                                  Width="100"
                                                  VerticalAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,32,0">
                            <TextBlock Text="DL:"
                                     Style="{StaticResource FluentMetricLabel}"
                                     VerticalAlignment="Center"
                                     Margin="0,0,8,0"/>
                            <controls:NumericUpDown Value="{Binding ImageRetrieverThreadCount}"
                                                  Minimum="1" Maximum="255"
                                                  Width="100"
                                                  VerticalAlignment="Center"/>
                        </StackPanel>

                        <Border Background="{DynamicResource FluentMetricBackgroundBrush}"
                              CornerRadius="4"
                              Padding="12,6"
                              VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <iconPacks:PackIconMaterial Kind="Image"
                                                          Width="16" Height="16"
                                                          Foreground="{DynamicResource FluentAccentBrush}"
                                                          VerticalAlignment="Center"
                                                          Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding OriginalImagePaths.Count, StringFormat='#,##0'}"
                                         Style="{StaticResource FluentMetricValue}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <Button Content="クリア"
                          Command="{Binding ClearOriginalImagesCommand}"
                          Style="{StaticResource FluentButtonSecondary}"
                          HorizontalAlignment="Right">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <iconPacks:PackIconMaterial Kind="DeleteOutline"
                                                              Width="16" Height="16"
                                                              Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </Grid>
            </StackPanel>
        </Border>

        <!-- 画像処理セクション -->
        <Border Grid.Row="3"
                Style="{StaticResource FluentCard}"
                Margin="8,4,8,8"
                IsEnabled="{Binding Connection, Converter={StaticResource NullToBooleanConverter}, ConverterParameter=true}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- セクションヘッダー -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                    <iconPacks:PackIconMaterial Kind="ImageEdit"
                                              Width="24" Height="24"
                                              Foreground="{StaticResource FluentAccentBrush}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,12,0"/>
                    <TextBlock Text="画像処理"
                             Style="{StaticResource FluentSectionHeader}"
                             Margin="0"/>
                </StackPanel>

                <!-- コントロールパネル -->
                <Grid Grid.Row="1" Margin="0,0,0,16">
                    <StackPanel Orientation="Horizontal">
                        <Button Content="処理開始"
                              Command="{Binding StartProcessingCommand}"
                              Style="{StaticResource FluentButton}"
                              Margin="0,0,32,0">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="Cog"
                                                                  Width="16" Height="16"
                                                                  Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>

                        <Border Background="{DynamicResource FluentMetricBackgroundBrush}"
                              CornerRadius="4"
                              Padding="12,8"
                              Margin="0,0,32,0"
                              VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <RadioButton Content="シングル"
                                           IsChecked="{Binding IsSingleThreadMode}"
                                           GroupName="ThreadMode"
                                           VerticalAlignment="Center"
                                           Margin="0,0,16,0"/>
                                <RadioButton Content="マルチ"
                                           IsChecked="{Binding IsMultiThreadMode}"
                                           GroupName="ThreadMode"
                                           VerticalAlignment="Center"
                                           Margin="0,0,16,0"/>
                                <StackPanel Orientation="Horizontal"
                                          IsEnabled="{Binding IsMultiThreadMode}">
                                    <TextBlock Text="数:"
                                             Style="{StaticResource FluentMetricLabel}"
                                             VerticalAlignment="Center"
                                             Margin="0,0,8,0"/>
                                    <controls:NumericUpDown Value="{Binding ImageProcessorThreadCount}"
                                                          Minimum="1" Maximum="255"
                                                          Width="100"
                                                          VerticalAlignment="Center"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <Border Background="{DynamicResource FluentMetricBackgroundBrush}"
                              CornerRadius="4"
                              Padding="12,6"
                              Margin="0,0,16,0"
                              VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <iconPacks:PackIconMaterial Kind="CheckCircle"
                                                          Width="16" Height="16"
                                                          Foreground="{StaticResource FluentSuccessBrush}"
                                                          VerticalAlignment="Center"
                                                          Margin="0,0,8,0"/>
                                <TextBlock Text="完了:"
                                         Style="{StaticResource FluentMetricLabel}"
                                         VerticalAlignment="Center"
                                         Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding ResultImagePaths.Count, StringFormat='#,##0'}"
                                         Style="{StaticResource FluentMetricValue}"/>
                            </StackPanel>
                        </Border>

                        <Border Background="{DynamicResource FluentMetricBackgroundBrush}"
                              CornerRadius="4"
                              Padding="12,6"
                              VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <iconPacks:PackIconMaterial Kind="Timer"
                                                          Width="16" Height="16"
                                                          Foreground="{DynamicResource FluentAccentBrush}"
                                                          VerticalAlignment="Center"
                                                          Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding ProcessingMilliseconds, StringFormat='#,##0 ms'}"
                                         Style="{StaticResource FluentMetricValue}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- 処理済み画像ギャラリー -->
                <ScrollViewer Grid.Row="2"
                            HorizontalScrollBarVisibility="Disabled"
                            VerticalScrollBarVisibility="Auto"
                            Background="Transparent">
                    <ItemsControl ItemsSource="{Binding ResultImagePaths}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="White"
                                      BorderBrush="{StaticResource FluentBorderBrush}"
                                      BorderThickness="1"
                                      CornerRadius="8"
                                      Margin="8"
                                      Padding="4">
                                    <Border.Effect>
                                        <DropShadowEffect Color="#000000"
                                                        Direction="270"
                                                        ShadowDepth="2"
                                                        BlurRadius="8"
                                                        Opacity="0.08"/>
                                    </Border.Effect>
                                    <Image Source="{Binding}"
                                         Width="150"
                                         Height="150"
                                         Stretch="UniformToFill"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- アクション -->
                <StackPanel Grid.Row="3"
                          Orientation="Horizontal"
                          HorizontalAlignment="Right"
                          Margin="0,12,0,0">
                    <Button Content="クリア"
                          Command="{Binding ClearResultImagesCommand}"
                          Style="{StaticResource FluentButtonSecondary}">
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <iconPacks:PackIconMaterial Kind="DeleteOutline"
                                                              Width="16" Height="16"
                                                              Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</controls:MetroWindow>
